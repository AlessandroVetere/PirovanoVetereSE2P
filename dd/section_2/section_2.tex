\section{Architectural Design}
This section exposes \myTaxiService{} Architectural Design in a complete e comprehensible way.
%
\subsection{Overview}
A quick but meaningful overview on the system architectural design is presented with the help of the following diagram, which is self explanatory:
\showGeneralDiagram{Overview Diagram}{1.0}
In addition are given many \textbf{UML Diagrams} integrated with complete descriptions of the software components in the following subsections:
\begin{itemize}
	\itemBold{Component View} Describes the division of the system in \textbf{Layers} and how the work flow is organized through them.
		It contains a \textbf{UML Component Diagram} that best delivers a comprehensive overlook.
	\itemBold{Deployment View} Explains how the division of system in \textbf{Tiers} is done with the help of an \textbf{UML Deployment Diagram}.
	\itemBold{Runtime View} Describes how each software components interacts with each other.
		To better explain the method call order and which component is used to obtain a given functionality, a set of \textbf{UML Sequence Diagram} is presented.
\end{itemize}
%
\subsection{High level components and their interaction}
In the following section are deeply covered all the architectural aspects that characterize the software to be.
In particular, here it is explained at a high level of abstraction how is designed the division of the system into \textbf{Layers} and \textbf{Tiers}.
%
\subsubsection{Layers}
The software architecture that has been chosen follows the principles of the \textbf{Model View Controller} architectural pattern.
Therefore three main software components have been identified and those are without any coup de theatre: the \textbf{Model}, the \textbf{View} and the \textbf{Controller}.
As already mentioned and explained through the \textbf{Overview Diagram}, the system has many distributed components: those will communicate with a \textbf{Client-Server} style and through \textbf{Point to Point} messaging system.
The \textbf{Client-Server} style is used in order to receive different requests (e.g. a \textbf{Taxi Reservation} request) from the many \textbf{Clients} connected to the \textbf{Server} to use the service.
The \textbf{Point to Point} bidirectional communication channel is made necessary to enable the \textbf{Server} the delivery of various messages and requests to the \textbf{Clients}.
These messages could be generic notifications, service messages or, in the particular case in which the connected client is a \textbf{Taxi Driver}, the request of serving a \textbf{Taxi Ride} and the request of an updated \textbf{GPS Data}.
\textbf{Model, View and Controller} are then mapped to three different relevant \textbf{Layers}.
%
\paragraph{View}
The role of this \textbf{Layer} is the one of processing remote \textbf{Clients} commands, and convert them into requests addressed to the \textbf{Controller} layer, that is connected to the \textbf{View} through a communication facility (e.g. The Internet).
There exists four different types of \textbf{View}, each one designed specifically for the particular \textbf{Client}:
\begin{itemize}
	\itemBold{Passenger Web View} Interface developed for the \textbf{Passengers}, accessible via a \textbf{Web Browser}.
	\itemBold{Passenger Application View} Interface developed for the \textbf{Passengers}, accessible via a dedicated \textbf{Mobile Application}.
	\itemBold{Taxi Driver Application View} Interface developed for the \textbf{Taxi Drivers}, accessible via a dedicated \textbf{Mobile Application}.
	\itemBold{Administrator View} Interface developed for \myTaxiService{} \textbf{Administrator}, accessible via the dedicated \textbf{Administrator Workstation}.
\end{itemize}
%
\paragraph{Controller}
This second \textbf{Layer} is composed itself of two families of components with specialized functionalities:
\begin{itemize}
	\itemBold{Networking Components Family} This family groups the software components that are involved in sending messages to the various \textbf{Views}, following the logic implements in the \textbf{Business Components Family}.
	This is also the entry point for requests generated by the \textbf{Views}, that are then dispatched to the various business components.
	\itemBold{Business Components Family} In this family are included all the software components that implement the system logic, processing requests and generating either responses or asynchronous events.
\end{itemize}
%
\paragraph{Model}
The third and last \textbf{Layer} is the \textbf{Model}, that should guarantee a high level interface to store and manage all the \myTaxiService{} relevant data.
It abstracts a \textbf{Relational Database} in a software component that is in direct connection with the \textbf{Controller}.
%
\subsubsection{Tiers}
Then it comes the division of the system in different \textbf{Tiers}:
\begin{itemize}
	\itemBold{Clients} The distributed clients of the application.
		The \textbf{View} layer is mapped only to this \textbf{Tier}.
	\itemBold{Web Server} A server that is in charge of dynamically generate web pages and receive requests through the web.
		It is also the server where are hosted the \textbf{Assets} of the web portal.
		The \textbf{Networking Components Family} of the \textbf{Controller} is mapped to this \textbf{Tier}.
	\itemBold{Application Server} This is the most important \textbf{Tier} of the system.
		Here are done all the logics and calculations that constitute the core part of \myTaxiService{}.
		The \textbf{Business Components Family} is hosted on this server and therefore it is a part of the \textbf{Controller} that is separated from the \textbf{Web Server}.
		It is necessary to have the \textbf{Controller} divided into two different \textbf{Tiers} in order to separate the most important software parts, that are the business logic components, from the network components, for security concerns.
	\itemBold{Database Server} In this \textbf{Tier} it is hosted the \textbf{Database} that allows the service data persistence.
		The \textbf{Model} layer is entirely mapped to this \textbf{Tier}.
\end{itemize}
This architecture, with three different \textbf{Layers} and four different \textbf{Tiers}, makes possible to have a \textbf{Client-Server} style with a \textbf{Fat-Server} and a \textbf{Thin-Client}: this is due to the mapping of the \textbf{View} to the \textbf{Clients} and the mapping of the \textbf{Controller} and the \textbf{Model} to the \textbf{Server}.
%
\subsection{Component view}
\showComponentDiagram{UML Component Diagram}{1.0}
Below are described all the software component that interact inside every subsystem; for the most important ones is also provided a description of the internal interfaces that they use to communicate one with each other.
The identified subsystems are:
\begin{itemize}
	\itemBold{Passenger View}
	In this subsystem are contained the following components:
	\begin{itemize}
		\itemBold{PS Application View and PS Web View} These are the software components that catch \textbf{Passenger} generated events, like the click on a button. In addition they are capable of showing responses and notifications received via network.
		It is an \textbf{Observable} component, which \textbf{Observer} is \textbf{PS Request Creator}.
		\itemBold{PS Request Creator} This software component translates each \textbf{Passenger} generated event into a request that is intended to be sent to the server.
		It is also capable of handling the server response.
		Furthermore it is an \textbf{Observer} component that is notified when specific events occur.
		\itemBold{PS Receiver} This component is in charge of handling asynchronous server notifications or requests.
		It is an \textbf{Observable} component which \textbf{Observer} is the \textbf{PS Application View and PS Web View}.
	\end{itemize}
	\itemBold{Taxi Driver View}
	In this subsystem are contained the following components:
	\begin{itemize}
		\itemBold{TD Application View} These are the software components that catch \textbf{Taxi Driver} generated events, like the click on a button. In addition they are capable of showing responses and notifications received via network.
		\itemBold{TD Request Creator} See \textbf{PS Request Creator}.
		\itemBold{TD Receiver} See \textbf{PS Receiver}
		\itemBold{TD Locator} This is the software component that accesses the interface to the \textbf{Taxi Driver GPS Data Source}. Once invoked by the \textbf{Location Manager}, it retrieves the \textbf{GPS Data} that identify the \textbf{Taxi Driver Position}. It is a fundamental part of the \textbf{Taxi Driver View} because it makes possible for the server to have a constantly updated \textbf{Model}.
		\itemBold{GPS Data Source} It is a software component that connects to the \textbf{GPS Driver} of the \textbf{Taxi Driver Smartphone}.
		It provides an object that represents the most recent position retrieved by the GPS Antenna; this object contains many data, among which the most important are \textbf{Latitude} and \textbf{Longitude}.
		In fact through these data it is possible to determine in a precise way the \textbf{Taxi Driver} position.
	\end{itemize}
	\itemBold{Controller}
	In this subsystem are contained the following components:
	\begin{itemize}
		\itemBold{RESTful Service}
		This \textbf{Networking Family} component receives requests from the \textbf{Clients}, elaborates them and then forwards related requests to components of the \textbf{Business Family}.
		It can handle a given number of requests in parallel: this number is configurable.
		In order to allow interaction with other components, it implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Receive TD Request} Allows \textbf{Clients} to send requests.
			\itemBold{Receive PS Request} See \textbf{Receive TD Request}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Login} Used to manage a login request made by a \textbf{Passenger} or a \textbf{Taxi Driver}.
			\itemBold{Logout} Used to handle a logout request made by a \textbf{Passenger} or a \textbf{Taxi Driver}.
			\itemBold{Register} Used to manage a registration request made by a \textbf{Passenger}.
			\itemBold{Modify Profile} Used to manage a profile modification request made by a \textbf{Passenger}.
			\itemBold{Report Problem} Used to manage a report problem request coming from a \textbf{Taxi Driver}.
			\itemBold{Add Taxi Ride} Used to handle a \textbf{Taxi Request} or \textbf{Taxi Reservation} request made by a \textbf{Passenger}.
			\itemBold{Remove Taxi Ride} Used to manage a \textbf{Taxi Ride} cancellation request coming from a \textbf{Passenger}.
		\end{itemize}
		\itemBold{Dispatcher} This software component is in charge of dispatching notification messages, system messages, and asynchronous requests (e.g. the request of accepting a \textbf{Taxi Ride} to a \textbf{Taxi Driver}) from the \textbf{Server} to the designed \textbf{Client}.
		In order to allow interaction with other components, it implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Dispatch Message} Allows other \textbf{Controller} software components to send many type of messages to the designated \textbf{Client}.
		\end{itemize}
			In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Receive PS Update} Used to make possible for \textbf{Clients} to receive messages coming from \textbf{Controller} internal software components.
			\itemBold{Receive TD Update} See \textbf{Receive PS Update}.	
		\end{itemize}
		\itemBold{Location Manager}
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Get Zone From Address} Associate a \textbf{Zone} of the \textbf{City} to a specific \textbf{Address}. It is used to categorize a just arrived \textbf{Taxi Ride}.
			\itemBold{Get TD Address} Allows the \textbf{Taxi Driver Manager} to request the actual \textbf{Address} of a given \textbf{Taxi Driver}, in order to store it in the \textbf{Model}.
			\itemBold{Compute Travel Time} Allows the calculation of the travel time between two \textbf{Addresses}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Get TD Position} Used to request \textbf{GPS Data} to a given \textbf{Taxi Driver}.
			\itemBold{Google Maps API} Used to request travel time between two \textbf{Addresses} and to associate \textbf{GPS Data} to the nearest \textbf{Address}.
			\itemBold{Query Zone Model} Used to query the \textbf{Model} about which \textbf{Zone} contains a given \textbf{Point} defined by the \textbf{Longitude} and \textbf{Latitude} of a \textbf{GPS Data} object.
			This interface is called to associate the \textbf{GPS Data} received from a \textbf{Taxi Driver} to a given \textbf{Zone}.
		\end{itemize}
		\itemBold{Queue Manager} This software component is in charge of:
		\begin{itemize}
			\item Manage \textbf{Taxi Driver Queues}, that are one for each \textbf{Zone} in the \textbf{City}.
			\item Each \textbf{Queue} contains only the \textbf{Available Taxi Drivers} in the corresponding \textbf{Zone}.
			\item When a \textbf{Taxi Driver} accepts the submitted \textbf{Taxi Ride}, this object generates a notification message. This message is clearly addressed to the \textbf{Taxi Ride}'s \textbf{Passenger} and it contains a reference to the\textbf{Taxi Driver} that has just accepted the request and the \textbf{Travel Time} remaining for the that \textbf{Taxi Driver} to reach the \textbf{Passenger} that is waiting.
			To compute the \textbf{Travel Time}, is called the \textbf{Location Manager}'s dedicated interface.
			\item When a \textbf{Taxi Driver} moves from one \textbf{Zone} to another one, this component is in charge of moving him from the old \textbf{Queue} to the new one.
			\item Serves a given number of \textbf{Taxi Rides} in parallel. That number is configurable. The exceeding request are put into a queue waiting to be served.
			\item Redistribute the \textbf{Taxi Rides}. When the \textbf{Queue} associated to the starting \textbf{Zone} of a served \textbf{Taxi Ride} is empty, the system waits a given timeout. After that if no \textbf{Taxi Driver} can be found in the current \textbf{Queue}, the \textbf{Queue Manager} searches for a \textbf{Taxi Driver} in \textbf{Queues} of the neighbour \textbf{Zones}.
			\item Redistribute \textbf{Taxi Drivers}. When a \textbf{Taxi Driver} refuses a \textbf{Taxi Ride} request, it is dequeued from the current \textbf{Queue} and then enqueued in the same \textbf{Queue}: this moves him to the last position.
		\end{itemize}
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{TD Zone Changed} Allows the \textbf{Taxi Driver Manager} to notify that a given \textbf{Taxi Driver} has moved to a different \textbf{Zone}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Queue Model} Used for moving a \textbf{Taxi Driver} from a \textbf{Queue} to another one, when he/she has changed \textbf{Zone}.
			In addition this interface allows to pick a \textbf{Taxi Driver} from the related \textbf{Queue} and associate he/she to a given \textbf{Taxi Ride}.
			\itemBold{Compute Travel Time} Used to calculate the \textbf{Travel Time} needed by the \textbf{Taxi Driver} for moving from his/her actual position to the \textbf{Taxi Ride Start Address}.
			\itemBold{Dispatch Message}	Used to send a notification to a \textbf{Taxi Driver} that has been associated to a given \textbf{Taxi Ride}.
		\end{itemize}
		\itemBold{Session Manager}
		It is in charge of handling the sessions of \myTaxiService{} users.
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Login} Allows a \textbf{Client} to login to \myTaxiService{} and therefore start a valid session.
			\itemBold{Logout} Allows a \textbf{Client} to logout from \myTaxiService{} and therefore terminate the current session.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Passenger Model} Used to manage \textbf{Passenger} active sessions (e.g. retrieve valid session tokens) in the \textbf{Model}.
			\itemBold{Query Taxi Driver Model} Used to manage \textbf{Taxi Driver} active sessions (e.g. retrieve valid session tokens) in the \textbf{Model}.
		\end{itemize}
		\itemBold{Profile Manager}
		It handles the registration of a new \textbf{Passenger} to the system and the modification of a given \textbf{Registered Passenger}'s profile.
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Register} Allows registration to \myTaxiService{} for \textbf{Non Registered Passengers}.
			\itemBold{Modify Profile} Allows profile modification to \textbf{Registered Passengers}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Passenger Model} Used to manage the \textbf{Model} part related to \textbf{Registered Passenger}, inserting new entries or modifying existing ones.
		\end{itemize}
		\itemBold{Taxi Driver Manager} It is in charge of manage all the business logic behind \textbf{Taxi Drivers}.
		This is a core component that, among the other things, periodically asks \textbf{GPS Data} to \textbf{Taxi Drivers}.
		It implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Report Problem} Allows \textbf{Taxi Driver} either to report a \textbf{Problem} or to communicate its subsequent \textbf{Solution}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{TD Zone Changed} Used as a shortcut to notify the \textbf{Queue Manager} that a given \textbf{Taxi Driver} has moved from one \textbf{Zone} to another one.
			\itemBold{Query Taxi Driver Model} A useful interface to the \textbf{Model}.
			It is used in the following cases:
			\begin{itemize}
				\item When the update of a given \textbf{Taxi Driver} geolocation data is retrieved, in order to maintain coherent the \textbf{Model}.
				\item When a \textbf{Problem} is reported, in order to store it in the \textbf{Model}.
				\item When a \textbf{Problem} is notified as \textbf{Solved} by the relevant \textbf{Taxi Driver}, in order to update the \textbf{Model}.
			\end{itemize}
			\itemBold{Dispatch Message} Used to send personalized messages to a given \textbf{Taxi Driver}.
			\itemBold{Get TD Address} Used to ask a given \textbf{Taxi Driver} his/her current location.
		\end{itemize}
		\itemBold{Taxi Ride Manager} It is in charge of manage all the business logic behind \textbf{Taxi Rides}.
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Add Taxi Ride} Allows to add \textbf{Taxi Ride} request to the \textbf{Model}.
			A \textbf{Taxi Ride} can be of two different types: \textbf{Taxi Request} and \textbf{Taxi Reservation}.
			The software behaves differently, basing of the request nature:
			\begin{itemize}
				\itemBold{Taxi Request} The request is added to a dedicated data structure in the \textbf{Model}, and it will be then served as soon as possible by the \textbf{Queue Manager}.
				\itemBold{Taxi Reservation} The request is added to a different dedicated data structure in the \textbf{Model}, and a timer is set to wake up a routine that, 10 minutes before the \textbf{Start Time} of the given \textbf{Taxi Reservation}, builds a \textbf{Taxi Request} out of the same \textbf{Taxi Reservation}, preserving all the relevant data.
				The timer uses the interface itself to perform its task.
			\end{itemize}
			\itemBold{Remove Taxi Ride} Allows \textbf{RESTful Service} to remove a \textbf{Taxi Ride} request already present in the \textbf{Model}.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Get Zone From TD Address} Used to compute the \textbf{Zone} to which a given \textbf{Address} belongs, in order to associate a \textbf{Starting Zone} to a given \textbf{Taxi Ride}. This is a core procedure of \myTaxiService{} application because querying the \textbf{Zone} field of a given \textbf{Taxi Ride} it is possible to know in which \textbf{Queue} should look for a \textbf{Taxi Driver}.
			\itemBold{Query Taxi Ride Model} Used to add and remove \textbf{Taxi Rides} from the \textbf{Model}.
		\end{itemize} 
		\itemBold{Taxi Sharing Manager} It is in charge on handling all the necessary operation related to \textbf{Taxi Sharing}.
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{\textit{myTaxiSharing} API} Allows \textbf{External Developers} to access \textit{myTaxiSharing} functionality through the use of standard set of programmative APIs.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Shareable Taxi Ride} Used to manage the \textbf{Model} part that is related to \textbf{Shareable Taxi Rides}.
		\end{itemize}
		\itemBold{Query Manager} It is a \textbf{Controller} component that acts as a uniform layer built above the \textbf{Model}, that is in fact located in to a different machine.
		This software component implements and exposes the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Queue Model} Allows the \textbf{Queue Manager} to manage \textbf{Queues}.
			\itemBold{Query Zone Model} Allows the \textbf{Location Manager} to retrieve the \textbf{Zone} associated to a given \textbf{GPS Data}.
			\itemBold{Query Passenger Model} Allows the \textbf{Session Manager} and the \textbf{Profile Manager} to manage the data related to \textbf{Registered Passengers}, and insert new ones.
			\itemBold{Query Taxi Driver Model} Allows the \textbf{Taxi Driver Manager} to retrieve, store and modify data related to \textbf{Taxi Drivers}.
			\itemBold{Query Taxi Ride Model} Allows the \textbf{Taxi Ride Manager} to read, update and insert data related to \textbf{Taxi Rides}.
			\itemBold{Query Shareable Taxi Ride} Allows the \textbf{Taxi Sharing Manager} to manage data related to \textbf{Shareable Taxi Rides}.
			\itemBold{Administrator Queries} Allows the \textbf{Administrator} to perform queries related to \textbf{Taxi Driver} profile management and \textbf{Taxi Driver} registration.
		\end{itemize}
		In addition it uses the following \textit{interfaces}:
		\begin{itemize}
			\itemBold{Query Model} Used to forward the method calls received by this component to the \textbf{Model} itself.
		\end{itemize}
	\end{itemize}
	\itemBold{Model}
	In this component are included the following subcomponents:
	\begin{itemize}
		\itemBold{Model Query Service}
		This component provides an aggregated interface rich of methods to access the relational model underlying with a high level of abstraction, protection and security.
		The interface that it implements is called Query Model and it is used by the Query Manager to query the model via RPC.
		\itemBold{Passenger DB Adapter}
		It is a utility component that implements and exposes Passenger related query methods, built above the Query Database interface to the Database Driver Adatper.
		\itemBold{Taxi Ride DB Adapter}
		It is a utility component that implements and exposes Taxi Ride related query methods, built above the Query Database interface to the Database Driver Adatper.
		\itemBold{Taxi Driver DB Adapter}
		It is a utility component that implements and exposes Taxi Driver related query methods, built above the Query Database interface to the Database Driver Adatper.
		\itemBold{Zone DB Adapter}
		It is a utility component that implements and exposes Zone related query methods, built above the Query Database interface to the Database Driver Adatper.
		\itemBold{Queue DB Adapter}
		It is a utility component that implements and exposes Queue related query methods, built above the Query Database interface to the Database Driver Adatper.
		\itemBold{Database Driver Adapter}
		This component is a wrapper built on the Database Driver (that can be JDBC) that provides a set of methods to perform the common operations that could be done on a relational database.
		In fact it connects to the Database Management System via a Database Driver.
		Those methods are exposed in a interface that is called Query Database, and the various DB Adapters calls them in a way that depends on the caller component itself.
	\end{itemize}
\end{itemize} 
%
\newpage
\subsection{Deployment view}
In this subsection is proposed a \textbf{UML Deployment Diagram} that shows how the software components are mapped into different \textbf{Tiers} that compose the system.
\showDeploymentDiagram{UML Deployment Diagram}{0.9}
%
\subsection{Runtime view}
In this subsection is proposed a \textbf{UML Sequence Diagrams} that shows how the software components that compose the system interacts in order to deliver the requested functionality.
\showSequenceDiagram{admin_td_reg}{UML Sequence Diagram - Taxi Driver Registration}{1.0}
\showSequenceDiagram{ps_registration}{UML Sequence Diagram - Passenger Registration}{1.0}
\showSequenceDiagram{ps_login}{UML Sequence Diagram - Passenger Login}{1.0}
\showSequenceDiagram{queue}{UML Sequence Diagram - Queue Management}{1.0}
\showSequenceDiagram{taxi_ride_arrived_handling}{UML Sequence Diagram - Taxi Ride Handling}{1.0}
\showSequenceDiagram{tr_timer_expired}{UML Sequence Diagram - Taxi Reservation Timer Expired}{1.0}
%
\subsection{Component interfaces}
Being our system composed of different software components that need to interact together, several interfaces have been put among them.
Subsequently are listed all the main software components and their interfaces, each one described in detail:
\begin{itemize}
	\itemBold{Passenger View}
	This component implements one interface:
	\begin{itemize}
		\itemBold{Receive PS Update} An interface over the \textbf{Web Socket} technology that is implemented by the \textbf{Passenger View} and called by the \textbf{Controller} in order to deliver updates to a particular Passenger.
		It is required that the \textbf{Passenger View} opens a \textbf{Web Socket} connection with the \textbf{Controller} in order to permit him of sending personal messages.
		Message delivery is intended to be asynchronous but in some cases the \textbf{Controller} waits, in the same communication channel, the response of the \textbf{Passenger View}. In this case the communication is synchronous.
	\end{itemize}
	This component utilizes one interface:
	\begin{itemize}
		\itemBold{Receive PS Request} An interface implemented by the \textbf{Controller} that exposes the necessary methods to build up a \textbf{RESTful Service} over the \textbf{HTTPS} protocol.
		Through this interface the \textbf{Passenger View} can send specific requests to the \textbf{Controller}, that synchronously responds with the necessary information.
	\end{itemize}
	\itemBold{Taxi Driver View}
	This component implements two interfaces:
	\begin{itemize}
		\itemBold{Receive TD Updated} As for the \textbf{Receive PS Update} interface, this interface over \textbf{Web Socket} technology is called by the \textbf{Controller} to deliver messages and requests to a particular Taxi Driver.
		It is required that a \textbf{Web Socket} connection is opened by the \textbf{Taxi Driver View} with the \textbf{Controller} in order to permit it to send messages.
		The delivery of message is asynchronous when a direct answer by the \textbf{Taxi Driver View} is not needed, in other cases the \textbf{Controller} makes a synchronous call to the \textbf{Taxi Driver View} and waits for it to send back the desired data.
		\itemBold{Get TD Position} This interface over \textbf{Web Socket} is called synchronously by the \textbf{Controller} to get the last position registered in the \textbf{Taxi Driver View}.
		This could be a crucial part of the system and therefore it is intended that no Taxi Driver hacks his own smartphone GPS location system in order to deliver wrong position (maybe introducing an important fee to be paid in case of this misbehaviour).
		The \textbf{Taxi Driver Web} must open a \textbf{Web Socket} connection with the \textbf{Controller} in order to permit him to ask the position.
	\end{itemize}
	This component utilizes one interface:
	\begin{itemize}
		\itemBold{Receive TD Request} An interface over \textbf{HTTPS} that is implemented by the \textbf{Controller} and like the \textbf{Receive PS Request} does for the Passenger, allows the Taxi Driver to send request to the \textbf{Controller}, while waiting synchronously for a response.
	\end{itemize}
	\itemBold{Administration View}
	This component utilizes one interface:
	\begin{itemize}
		\itemBold{Administrator Queries} This interface is provided by the \textbf{Controller} via \textbf{RPC} technology (whose implementation could be \textbf{RMI}) and allows the \textbf{Administrator View} to perform some crucial activities and queries on the \myTaxiService{} model in a more direct and powerful way. Through this interface it is allowed the registration of a new Taxi Driver.
		This interface is not intended to be publicly accessible, and therefore it is better not to expose it through a public IP.
		In addition, because of the very direct and uncontrolled nature of this communication channel, it is intended that the Administrators are trained personnel and are very discouraged to damage or break the system they are interacting with.
	\end{itemize}
	\itemBold{Model}
	This component implements one interface:
	\begin{itemize}
		\itemBold{Query Model} It is an interface over \textbf{RPC} technology (could as well be \textbf{RMI}) that allows the \textbf{Controller} to do all kind of interesting relational queries on the \myTaxiService{} model, through a set of exposed and controlled methods.
		It abstracts the concept of relational query to a higher level of usability and security.
		The model to which the interface refers is at its core a relational database, that is accessed through a \textbf{Database Driver Adapter}, that could wrap up a database driver like \textbf{JDBC}.
	\end{itemize}
	\itemBold{Controller}
	This is the central part of \myTaxiService{} system and has the greatest number of implemented and utilized interfaces.
	It implements 4 different interfaces:
	\begin{itemize}
		\itemBold{myTaxiSharing API} This interface provided through \textbf{HTTPS} is intended to be utilized by the developers that wants to further develop \myTaxiService{}, by adding the Taxi Sharing capability.
		It is not intended to be accessible publicly and therefore it must be protected using firewalls and access control management, with credential authentication.
		A developer that wants to utilize the API, must request the permission to the Administrator, that creates valid credentials, configures the system accordingly, and communicate him/her those credentials.
		\itemBold{Receive PS Request} Already presented above in \textbf{Passenger View} interfaces analysis.
		\itemBold{Receive TD Request} Already presented above in \textbf{Taxi Driver View} interfaces analysis.
		\itemBold{Administrator Queries} Already presented above in \textbf{Administrator View} interfaces analysis.
	\end{itemize}
\end{itemize}
%
\subsection{Selected architectural styles and patterns}
Several architectural styles and patterns were chosen in order to build \myTaxiService{} as a modern software.
The main pattern that was recursively adopted is the \textbf{Model View Controller} architectural pattern:
\begin{itemize}
	\itemBold{System Level} All the clients that use \myTaxiService{} (i.e. the \textbf{Passengers}, the \textbf{Taxi Drivers}, and the \textbf{Administrator}) are seen as \textbf{Views}, that following the \textbf{Cocoa MVC} pattern, are connected to a \textbf{Controller}, the \textbf{Web Server} or the \textbf{Application Server}, that is itself connected to the \textbf{Model} that is hosted on the \textbf{Database Server}.
	\itemBold{Client Level} The \textbf{Views} in the various \textbf{Clients} are designed internally to conform to the \textbf{MVC} pattern. For instance the \textbf{Passenger View} is composed of a \textbf{Model} that is an internal representation of the data received by the \textbf{Web Server}, a \textbf{Controller} that performs network activities and connects the \textbf{Model} with the \textbf{View}, and the \textbf{View} that is either a \textbf{Mobile Application GUI} or a \textbf{Web Page}.
	\itemBold{Server Level} The server part of \myTaxiService{} is divided also physically into the three different entities of the \textbf{MVC} pattern:
	\begin{itemize}
		\itemBold{Web Server} It is the \textbf{View} of the server part of the application, and gives to clients a representation of the internal data. The \textbf{Web Server} is connected only to the \textbf{Application Server}. It contains all the assets included in the web portal. On its external interface, it can handle properly \textbf{HTTPS} requests and manage communication over \textbf{Web Sockets}. On its internal interface it sends and receives objects via \textbf{RPC} from the \textbf{Application Server}, that is in charge of the application logic.
		\itemBold{Application Server} That is the \textbf{Controller} of the server and it is connected with the \textbf{Web Server} and the \textbf{Database Server} via \textbf{RPC}. It contains most of the business logic behind \myTaxiService{} and therefore it is a core part of the system. It should be reachable only within the enterprise network, and not via public IP. The connection to the \textbf{Web Server} is used to receive requests, to deliver responses to clients and to send asynchronous requests to them, when it is needed. On the other hand is necessary a connection with the \textbf{Database Server} in order to connect the \textbf{Controller} with the \textbf{Model}. It is also used to store all the important data and react to some data modifications that occurs during the execution of the application.
		\itemBold{Database Server} It is the \textbf{Model} of the server, and in fact is the \textbf{Model} of the whole \myTaxiService{} system. It relies on an \textbf{RPC} connection with the \textbf{Application Server} and it is not directly reachable via a public IP. The \textbf{Database Server} is connected to a relational database via a \textbf{Database Driver Adapter}, that is a wrapper built over the \textbf{DBMS} installed on the \textbf{Database Server Operating System}. Following the \textbf{Cocoa MVC} pattern, it is not directly connected to the \textbf{View} of the server, that is the \textbf{Web Server}, but only to the \textbf{Controller}, that is the \textbf{Application Server}.
	\end{itemize}
\end{itemize}
Alongside the \textbf{MVC} architectural pattern, also the \textbf{Client-Server} style is used for all the requests done by the various clients connected to the Web Server of \myTaxiService{}. The \textbf{Taxi Driver Application} and the \textbf{Passenger Application} can use a standardized \textbf{Client-Server} protocol via \textbf{HTTPS} that follows the principle of a \textbf{RESTful Service}. The \textbf{Administrator} application its connected via \textbf{RPC} to the \textbf{Web Server} and can perform more critical requests, like the registration of a new \textbf{Taxi Driver} into the system. It is required that the \textbf{Administrator} application opens a \textbf{RPC} connection to the \textbf{Web Server} to start the communication.
A \textbf{Point to Point} bidirectional messaging system is established between the \textbf{Clients} and the \textbf{Web Server} at the \textit{boot} of the client application. The client should explicitly request a connection to the server that is listening for clients' connections. It is the connection over \textbf{Web Socket} protocol that allows the \textbf{Web Server} to send asynchronous messages and requests to which the client can respond using the same channel. The main reasons why this protocol is used are sending a \textbf{Taxi Ride} proposal to a given \textbf{Taxi Driver}, that can either accept or deny the proposal, and allowing the server to ask the \textbf{Taxi Driver} an updated geolocation data.
The \textbf{Client-Server} style and \textbf{Point to Point} bidirectional messaging system are used to implement properly the \textbf{MVC} pattern in this three \textbf{Layers}, four \textbf{Tiers} system.
The three \textbf{Layers} have already been discussed and are:
\begin{itemize}
	\itemBold{Data Layer} That is the System Level \textbf{Model}.
	\itemBold{Business Logic Layer} That is the System Level \textbf{Controller}.
	\itemBold{Presentation Layer} That is the System Level \textbf{View}.
\end{itemize}
These \textbf{Layers}, as already said, are mapped into four different \textbf{Tiers}:
\begin{itemize}
	\itemBold{Clients} They map the System Level \textbf{View}.
	\itemBold{Web Server} It maps a portion of the System Level \textbf{Controller}, that is the one of the \textbf{RESTful Service}, \textbf{Dispatcher}, and part of the \textbf{Location Manager}, onto software objects that provide the required network capabilities.
	\itemBold{Application Server} This \textbf{Tier} maps the purely logical part of the System Level \textbf{Controller}.
	\itemBold{Database Server} It maps the System Level \textbf{Model}.
\end{itemize}
%
\subsection{Other design decisions}
Several technologies have been chosen in order to best fit the needs of the system to be.
Not all the required functionalities of \myTaxiService{} are already mapped onto specific products because in those cases the choice done would matter less.
But for the cases in which a technology has already been proposed, it is because a clear design decision was mandatory.
As for the communication protocols between clients (excluded the Administrator client) and the server have been chosen:
\begin{itemize}
	\itemBold{HTTPS} The secure version of \textbf{HTTP} was a mandatory choice as security and privacy concerns are of major importance nowadays.
	\itemBold{Web Socket} This innovative socket technology has been chosen although is relatively new because it implements a full duplex socket communication channel using web technology and therefore using the port 80, which is in almost every case not blocked by any firewall.
\end{itemize}
For what concerns the network reachability has been chosen to make discoverable only the Web Server through the assignment to it of a public IP.
All the other servers in \myTaxiService{} system should be reachable only within the enterprise network.
Between the \textbf{Web Server} and the external network is installed a firewall that controls all the incoming connections.
In particular it must accept only incoming \textbf{HTTPS} connections, \textbf{Web Socket} connections and \textbf{RPC} connections.
A firewall is also used to protected the Database Server from the \textbf{Application Server} in the unlikely case that the \textbf{Application Server} is attacked through the \textbf{Web Server} or the \textbf{Application Server} for some reasons stops working correctly and start behaving in a way that will damage the application \textbf{Model}.
Also, another interesting design choice that has been made concerns the way in which the \textbf{GPS coordinates} obtained from a given \textbf{Taxi Driver} are mapped into a specific \textbf{Zone}.
It could have been possible, but not feasible, to do such a thing:
\begin{enumerate}
	\item Obtain \textbf{GPS Data} via \textbf{Web Socket} from the selected \textbf{Taxi Driver}.
	\item Calculate the nearest \textbf{Address} of the given \textbf{GPS Data} using \textbf{Google Maps HTTPS API}.
	\item Query the \textbf{Model} to obtain the \textbf{Zone} to which belongs the given \textbf{Address}.
\end{enumerate}
But this solution requires to have a precomputed data structure that associates every \textbf{Address} in the \textbf{City} to the corresponding \textbf{Zone} (that could have been a relational table with as many rows inside as \textbf{Addresses} in the \textbf{City}, each address associated with the corresponding \textbf{Zone}), that is heavy to manage and maintain, although if correctly installed and filled, it gives for certain good performances.
A less heavy weight solution has been found: this solution expects every \textbf{Zone} of the \textbf{City} to be divided in several convex \textbf{Polygons}, for instance \textbf{Triangles}, that have interesting properties for our application.
In \myTaxiService{}, \textbf{Zones} of regular shape are intended to be designed, and therefore the number of \textbf{Triangles} in which a \textbf{Zone} should be decomposed is very limited.
So, such a flow is followed:
\begin{enumerate}
	\item Obtain \textbf{GPS Data} via \textbf{Web Socket} from the selected Taxi Driver
	\item For each \textbf{Zone}, check if the \textbf{Point} that the \textbf{Longitude} and \textbf{Latitude} from \textbf{GPS Data} identify is contained inside any \textbf{Triangle} in which the \textbf{Zone} is divided. If that is the case, then the \textbf{Zone} is found. If that is not the case, then another \textbf{Zone} could contain the given Point. If no \textbf{Zone} contains the Point, then we can assume that the \textbf{Point} refers to \textbf{GPS Data} that identify a geographical point outside of the \textbf{City}.
\end{enumerate}
The computation of the \textbf{Point in Triangle} test is simple and efficient (e.g. using barycentric coordinates) and an algorithm designed in \textbf{Java} is provided in the following section.
